<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="waywiser">
<title>Assessing models with waywiser • waywiser</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing models with waywiser">
<meta property="og:description" content="waywiser">
<meta property="og:image" content="https://docs.ropensci.org/waywiser/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">waywiser</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="active nav-item">
  <a class="nav-link" href="../articles/waywiser.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Feature-Matrix.html">Feature matrix</a>
    <a class="dropdown-item" href="../articles/multi-scale-assessment.html">Multi-scale model assessment</a>
    <a class="dropdown-item" href="../articles/residual-autocorrelation.html">Calculating residual spatial autocorrelation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/waywiser/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assessing models with waywiser</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/waywiser/blob/HEAD/vignettes/waywiser.Rmd" class="external-link"><code>vignettes/waywiser.Rmd</code></a></small>
      <div class="d-none name"><code>waywiser.Rmd</code></div>
    </div>

    
    
<p>The waywiser package aims to be an ergonomic toolbox providing a consistent user interface for assessing spatial models. To that end, waywiser does three main things:</p>
<ol style="list-style-type: decimal">
<li>Provides new <a href="https://yardstick.tidymodels.org/" class="external-link">yardstick</a> extensions, making it easier to use performance metrics from the spatial modeling literature via a standardized API.</li>
<li>Provides a new function, <code><a href="../reference/ww_multi_scale.html">ww_multi_scale()</a></code>, which makes it easy to see how model performance metrics change when predictions are aggregated to various scales.</li>
<li>Provides an implementation of the <a href="https://doi.org/10.1111/2041-210X.13650" class="external-link">area of applicability from Meyer and Pebesma 2021</a>, extending this tool to work with tidymodels infrastructure.</li>
</ol>
<p>This vignette will walk through each of these goals in turn. Before we do that, let’s set up the data we’ll use in examples. We’ll be using simulated data based on <a href="https://www.worldclim.org/" class="external-link">Worldclim</a> variables; our predictors here represent temperature and precipitation values at sampled locations, while, our response represents a virtual species distribution:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/waywiser">waywiser</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span></span>
<span><span class="va">worldclim_training</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">worldclim_simulation</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">worldclim_testing</span> <span class="op">&lt;-</span> <span class="va">worldclim_simulation</span><span class="op">[</span><span class="op">-</span><span class="va">worldclim_training</span>, <span class="op">]</span></span>
<span><span class="va">worldclim_training</span> <span class="op">&lt;-</span> <span class="va">worldclim_simulation</span><span class="op">[</span><span class="va">worldclim_training</span>, <span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">worldclim_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">response</span> <span class="op">~</span> <span class="va">bio2</span> <span class="op">+</span> <span class="va">bio10</span> <span class="op">+</span> <span class="va">bio13</span> <span class="op">+</span> <span class="va">bio19</span>,</span>
<span>  <span class="va">worldclim_training</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">worldclim_testing</span><span class="op">$</span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_model</span>,</span>
<span>  <span class="va">worldclim_testing</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">worldclim_testing</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -156.2436 ymin: 3.924933 xmax: 52.85843 ymax: 48.72934</span></span>
<span><span class="co">#&gt; Geodetic CRS:  +proj=longlat +datum=WGS84 +no_defs</span></span>
<span><span class="co">#&gt;      bio2 bio10 bio13 bio19                   geometry   response predictions</span></span>
<span><span class="co">#&gt; 8001  150   256    12    32   POINT (36.1216 30.23658) 0.65981755  0.60203146</span></span>
<span><span class="co">#&gt; 8002   85   248    82   196 POINT (-156.2436 19.73569) 0.30859908  0.30053636</span></span>
<span><span class="co">#&gt; 8003  178   275    56    33 POINT (-103.2796 31.85488) 0.47365646  0.65660673</span></span>
<span><span class="co">#&gt; 8004  100   200    74    99  POINT (20.64971 47.14207) 0.47266462  0.39658926</span></span>
<span><span class="co">#&gt; 8005   68   262   296   746 POINT (-81.33804 3.924933) 0.00863417 -0.01075431</span></span>
<span><span class="co">#&gt; 8006  112   241    21    48  POINT (52.85843 48.72934) 0.63255439  0.46702575</span></span></code></pre></div>
<div class="section level2">
<h2 id="yardstick-extensions">Yardstick Extensions<a class="anchor" aria-label="anchor" href="#yardstick-extensions"></a>
</h2>
<p>First and foremost, waywiser provides a host of new yardstick metrics to provide a standardized interface for various performance metrics.</p>
<p>All of these functions work more or less the same way: you provide your data, the names of your “true” values and predicted values, and get back a standardized output format. As usual with yardstick, that output can either be a tibble or a vector output. For instance, if we want to calculate the agreement coefficient from <a href="https://doi.org/10.14358/PERS.72.7.823" class="external-link">Ji and Gallo 2006</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ww_agreement_coefficient.html">ww_agreement_coefficient</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric               .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> agreement_coefficient standard       0.675</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ww_agreement_coefficient.html">ww_agreement_coefficient_vec</a></span><span class="op">(</span></span>
<span>  truth <span class="op">=</span> <span class="va">worldclim_testing</span><span class="op">$</span><span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">worldclim_testing</span><span class="op">$</span><span class="va">predictions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6753398</span></span></code></pre></div>
<p>Some of these additional metrics are implemented by wrapping functions from the <a href="https://r-spatial.github.io/spdep/" class="external-link">spdep</a> package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/global_geary_c.html">ww_global_geary_c</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric        .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> global_geary_c standard       0.166</span></span></code></pre></div>
<p>These functions rely on calculating the spatial neighbors of each observation. The waywiser package will automatically use <code><a href="../reference/ww_build_weights.html">ww_build_weights()</a></code> to calculate these, if not provided, but this is often not desirable. For that reason, these functions all have a <code>wt</code> argument, which can take either pre-calculated weights or a function that will create spatial weights:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/global_geary_c.html">ww_global_geary_c</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  wt <span class="op">=</span> <span class="fu"><a href="../reference/ww_build_weights.html">ww_build_weights</a></span><span class="op">(</span><span class="va">worldclim_testing</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric        .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> global_geary_c standard       0.166</span></span>
<span></span>
<span><span class="fu"><a href="../reference/global_geary_c.html">ww_global_geary_c</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  wt <span class="op">=</span> <span class="va">ww_build_weights</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric        .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> global_geary_c standard       0.166</span></span></code></pre></div>
<p>Because these are yardstick metrics, they can be used with <code><a href="https://yardstick.tidymodels.org/reference/metric_set.html" class="external-link">yardstick::metric_set()</a></code> and other tidymodels infrastructure:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/metric_set.html" class="external-link">metric_set</a></span><span class="op">(</span></span>
<span>  <span class="va">ww_agreement_coefficient</span>,</span>
<span>  <span class="va">ww_global_geary_c</span></span>
<span><span class="op">)</span><span class="op">(</span><span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   .metric               .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> agreement_coefficient standard       0.675</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> global_geary_c        standard       0.166</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multi-scale-model-assessment">Multi-scale model assessment<a class="anchor" aria-label="anchor" href="#multi-scale-model-assessment"></a>
</h2>
<p>A common pattern with spatial models is that you need to predict observation units – pixels of a raster or individual points – which will be aggregated to arbitrary scales, such as towns or parcel boundaries. Because errors can be spatially distributed, or can either compound or counteract each other when aggregated, <a href="https://doi.org/10.1016/j.rse.2010.05.010" class="external-link">some assessment protocols</a> recommend assessing model predictions aggregated to multiple scales.</p>
<p>The <code><a href="../reference/ww_multi_scale.html">ww_multi_scale()</a></code> function helps automate this process. The interface for this function works similarly to that for yardstick metrics – you provide your data, your true values, and your estimate – except you also must provide instructions for how to aggregate your data. You can do this by passing arguments that will be used by <code><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">sf::st_make_grid()</a></code>; for instance, we can use the <code>n</code> argument to control how many polygons our grid has in the x and y directions.</p>
<p>Note that each element of argument vector is used to make a separate grid – so, for instance, passing <code>n = c(2, 4)</code> will result in one 2-by-2 grid and one 4-by-4 grid, because <code>n[[1]]</code> is 2 and <code>n[[2]]</code> is 4. If we actually wanted to create a 2-by-4 grid, by passing <code><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">sf::st_make_grid()</a></code> the argument <code>n = c(2, 4)</code>, we need to wrap that vector in a list so that running <code>n[[1]]</code> returns <code>c(2, 4)</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ww_multi_scale.html">ww_multi_scale</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ww_agreement_coefficient</span>, <span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/rmse.html" class="external-link">rmse</a></span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   .metric               .estimator .estimate .grid_args       .grid  .notes  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> agreement_coefficient standard      0.202  <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf&gt;</span>   <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> rmse                  standard      0.039<span style="text-decoration: underline;">1</span> <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf&gt;</span>   <span style="color: #949494;">&lt;tibble&gt;</span></span></span></code></pre></div>
<p>You can also pass polygons directly, if you have pre-defined grids you’d like to use:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">worldclim_testing</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ww_multi_scale.html">ww_multi_scale</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">response</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ww_agreement_coefficient</span>, <span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/rmse.html" class="external-link">rmse</a></span><span class="op">)</span>,</span>
<span>  grids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some observations were not within any grid cell, and as such were not used in any assessments.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> See the `.notes` column for details.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   .metric               .estimator .estimate .grid_args       .grid  .notes  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> agreement_coefficient standard      0.150  <span style="color: #949494;">&lt;tibble [0 × 0]&gt;</span> <span style="color: #949494;">&lt;sf&gt;</span>   <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> rmse                  standard      0.041<span style="text-decoration: underline;">8</span> <span style="color: #949494;">&lt;tibble [0 × 0]&gt;</span> <span style="color: #949494;">&lt;sf&gt;</span>   <span style="color: #949494;">&lt;tibble&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="area-of-applicability">Area of Applicability<a class="anchor" aria-label="anchor" href="#area-of-applicability"></a>
</h2>
<p>Last but not least, we can also see if there’s any areas in our data that are too different from our training data for us to safely predict on, which fall outside the “area of applicability” defined by <a href="https://doi.org/10.1111/2041-210X.13650" class="external-link">Meyer and Pebesma (2021)</a>. This approach looks at how similar the predictor values of new data are to the data you used to train your data, with each predictor weighted by how important it is to your model.</p>
<p>In order to calculate your area of applicability, you can pass <code><a href="../reference/ww_area_of_applicability.html">ww_area_of_applicability()</a></code> information about which of your variables are used as predictors in your model, your training data, and the importance scores for each of your variables. Out of the box, waywiser should work with any of the importance score-calculating functions from the vip package:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worldclim_aoa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ww_area_of_applicability.html">ww_area_of_applicability</a></span><span class="op">(</span></span>
<span>  <span class="va">response</span> <span class="op">~</span> <span class="va">bio2</span> <span class="op">+</span> <span class="va">bio10</span> <span class="op">+</span> <span class="va">bio13</span> <span class="op">+</span> <span class="va">bio19</span>,</span>
<span>  <span class="va">worldclim_training</span>,</span>
<span>  importance <span class="op">=</span> <span class="fu">vip</span><span class="fu">::</span><span class="fu"><a href="https://koalaverse.github.io/vip/reference/vi_model.html" class="external-link">vi_model</a></span><span class="op">(</span><span class="va">worldclim_model</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">worldclim_aoa</span></span>
<span><span class="co">#&gt; # Predictors:</span></span>
<span><span class="co">#&gt;    4</span></span>
<span><span class="co">#&gt; Area-of-applicability threshold:</span></span>
<span><span class="co">#&gt;    0.1038107</span></span></code></pre></div>
<p>You can also pass a data.frame with columns named “term” and “estimate” (containing the name of each term, or predictor, and their estimated importance) rather than using the vip package if that’s more convenient.</p>
<p>The objects returned by <code><a href="../reference/ww_area_of_applicability.html">ww_area_of_applicability()</a></code> are models in their own right, which can be used by functions such as <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> to calculate if new observations are in the area of applicability of a model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worldclim_testing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">worldclim_testing</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">worldclim_aoa</span>, <span class="va">worldclim_testing</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">worldclim_testing</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -156.2436 ymin: 3.924933 xmax: 52.85843 ymax: 48.72934</span></span>
<span><span class="co">#&gt; Geodetic CRS:  +proj=longlat +datum=WGS84 +no_defs</span></span>
<span><span class="co">#&gt;      bio2 bio10 bio13 bio19   response predictions         di  aoa</span></span>
<span><span class="co">#&gt; 8001  150   256    12    32 0.65981755  0.60203146 0.03315007 TRUE</span></span>
<span><span class="co">#&gt; 8002   85   248    82   196 0.30859908  0.30053636 0.08787721 TRUE</span></span>
<span><span class="co">#&gt; 8003  178   275    56    33 0.47365646  0.65660673 0.04132990 TRUE</span></span>
<span><span class="co">#&gt; 8004  100   200    74    99 0.47266462  0.39658926 0.04877910 TRUE</span></span>
<span><span class="co">#&gt; 8005   68   262   296   746 0.00863417 -0.01075431 0.00000000 TRUE</span></span>
<span><span class="co">#&gt; 8006  112   241    21    48 0.63255439  0.46702575 0.00000000 TRUE</span></span>
<span><span class="co">#&gt;                        geometry</span></span>
<span><span class="co">#&gt; 8001   POINT (36.1216 30.23658)</span></span>
<span><span class="co">#&gt; 8002 POINT (-156.2436 19.73569)</span></span>
<span><span class="co">#&gt; 8003 POINT (-103.2796 31.85488)</span></span>
<span><span class="co">#&gt; 8004  POINT (20.64971 47.14207)</span></span>
<span><span class="co">#&gt; 8005 POINT (-81.33804 3.924933)</span></span>
<span><span class="co">#&gt; 8006  POINT (52.85843 48.72934)</span></span></code></pre></div>
<p>The predict function returns the “distance index”, or “di”, for each observation: a score of how far away the observation is, in predictor space, from your training data. Points with a “di” higher than a set threshold are “outside” the area of applicability. We can visualize our test set here to see that our model often, but not always, performs worse on observations with a higher “di”:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">worldclim_testing</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">di</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">response</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">aoa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><img src="waywiser_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
